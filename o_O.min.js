!function(){function a(){}function b(a,b){if(a.forEach)return a.forEach(b);for(var c=0,d=a.length;c<d;c++)c in a&&b.call(null,a[c],c,a)}function c(a){return a.replace(/^\s+|\s+$/g,"")}function f(b){function c(b){return arguments.length?(c.value=b,d(c)):e&&a.__deps_hook.emit("get",c),c.value}return c.value=b,c.dependencies=[],c.incr=function(a){c(c.value+(a||1))},c}function g(b){function c(f){return arguments.length?(c.old_value=c.value,c.value=b(f),d(c)):(c.value=b(),e&&a.__deps_hook.emit("get",c)),c.value}return c.dependencies=a.dependencies(c),c}function h(a,b,c){if(a.indexOf)return a.indexOf(b,c);for(var d=c||0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1}function i(a,b){var c=[];for(var d=0;d<a.length;d++)c.push(b(a[d],d));return c}function j(a){var b=c(a).split(";"),d=[];for(var e=0;e<b.length;e++){var f=b[e];f=c(f);if(!f)continue;var g=i(c(f).split(":"),c),h=c(g.shift()),j=c(g.join(":"));d.push([h,j])}return d}function k(b){if(this.constructor!=k)return new k(b);this.objects={},this.count=a.property(0),this.id=0,a.eventize(this);if(b)for(var c=0;c<b.length;c++)this.add(b[c])}typeof module!="undefined"?module.exports=a:window.o_O=a,a.uniqueId=function(){var b=++a.uniqueId.id,c=a.uniqueId.prefix;return c?c+b:b},a.uniqueId.id=0,!function(){var b=Array.prototype.slice,c={on:function(a,b,c){var d;a=a.split(/\s+/);var e=this._callbacks||(this._callbacks={});while(d=a.shift()){var f=e[d]||(e[d]={}),g=f.tail||(f.tail=f.next={});g.callback=b,g.context=c,f.tail=g.next={}}return this},off:function(a,b,c){var d,e,f;if(!a)delete this._callbacks;else if(e=this._callbacks){a=a.split(/\s+/);while(d=a.shift()){f=e[d],delete e[d];if(!b||!f)continue;while((f=f.next)&&f.next){if(f.callback===b&&(!c||f.context===c))continue;this.on(d,f.callback,f.context)}}}return this},emit:function(a){var c,d,e,f,g,h,i;if(!(e=this._callbacks))return this;h=e["*"],(a=a.split(/\s+/)).push(null);while(c=a.shift()){h&&a.push({next:h.next,tail:h.tail,event:c});if(!(d=e[c]))continue;a.push({next:d.next,tail:d.tail})}i=b.call(arguments,1);while(d=a.pop()){f=d.tail,g=d.event?[d.event].concat(i):i;while((d=d.next)!==f)d.callback.apply(d.context||this,g)}return this}};a.eventize=function(a){for(var b in c)a[b]=c[b];return a}}(),a.property=function(b){var c=typeof b=="function",d=c?g(b):f(b);return a.eventize(d),d.change=function(a){a?d.on("set",a):d(d())},d.toString=function(){return"#<Property:"+d.value+">"},d.__o_O=!0,d},a.property.is=function(a){return a.__o_O==1};var d=function(){function c(){for(var c=0;c<a.length;c++){var d=a[c];d.emit("set",d.value,d.old_value),delete d._emitting}b=null,a=[]}var a=[],b=null;return function(d){if(d._emitting)return;a.push(d),d._emitting=!0,b=b||setTimeout(function(){c()},0)}}(),e=!1;a.__deps_hook=a.eventize({}),a.dependencies=function(b){function d(a){h(c,a)<0&&a!=b&&c.push(a)}var c=[];return e=!0,a.__deps_hook.on("get",d),a.dependencies.lastResult=b(),a.__deps_hook.off("get",d),e=!1,c},a.expression=function(b){return a.expression.last=b,new Function("o_O","with(this) { { return ("+b+")} } ")},a.bindFunction=function(c,d){var e=a.dependencies(c),f=a.dependencies.lastResult,g=typeof f=="function";d(f),g||b(e,function(a){a.on("set",function(a){d(c())})})},a.bindElementToRule=function(b,c,d,e){var f=a.expression(d),g=function(){return f.call(e,a.helpers)};a.bindFunction(g,function(d){var f=typeof d=="function"&&!a.property.is(d)?function(){return d.apply(e,arguments)}:d;return $.fn[c]?(f instanceof String&&(f=f.toString()),$(b)[c].call($(b),f)):a.bindings[c].call(e,f,$(b))})},a.bind=function(b,c){function e(c,d,e){var f=$(c),g=j(f.attr("bind"));for(var h=0;h<g.length;h++)a.bindElementToRule(f,g[h][0],g[h][1],b);f.attr("bind",null)}var d=$(c);b.el=d[0],$(c).filter("[bind^=foreach]").each(function(a,b){e(this,a,b)}),$(c).find("[bind^=foreach]").each(function(a,b){e(this,a,b)}),$(c).filter("[bind]").each(function(a,b){e(this,a,b)}),$(c).find("[bind]").each(function(a,b){e(this,a,b)}),b.onbind&&b.onbind()},a.helpers={},a.helpers.value=function(a){return function(b){return a.call(this,$(b.currentTarget).val(),b)}},a.helpers.mousepos=function(a){return function(b){var c=b.currentTarget,d=$(c).offset();a.call(this,b.pageX-d.left,b.pageY-d.top,b)}},a.bindings={},a.bindings["class"]=function(a,b){b.attr("class",a)},a.bindings.value=function(a,b){a.on("set",function(a){b.attr("type")=="checkbox"?b.attr("checked",a):b.val(a)}),b.change(function(b){var c=$(this).attr("type")=="checkbox",d=c?!!$(this).attr("checked"):$(this).val();a(d,b)}),a.change()},a.bindings.visible=function(a,b){a?b.show():b.hide()},a.bindings["if"]=function(a,b){a||b.remove()},a.bindings.nif=function(a,b){a&&b.remove()},a.bindings.options=function(a,b){var c=a instanceof Array;$.each(a,function(a,d){var e=c?d:a;b.append($("<option>").attr("value",d).html(e))})},a.bindings.foreach=function(b,c){var d=c.html();c.html(""),c.data("o_O:template",d);var e=b.render||function(b){var e=$(d).appendTo(c);a.bind(b,e)};b.forEach(function(a,b){e(a,c)}),b.bind&&b.bind(c)},!function(){function b(a,c){return b.extend(a,c)}b.extend=function(c,d){d==null&&(d=c,c=undefined),d=d||{};var e=function f(b){if(!(this instanceof f))return new f(b);b=b||{},a.eventize(this);for(var e in d){var g=e in b?b[e]:d[e];this[e]=a.property(g),this.observeProperty(e)}this.type=c,this.id=b.id||a.uniqueId(),this.initialize.call(this,b),f.emit("create",this)};return a.eventize(e),a.inherits(e,this),c&&(b.models[c]=e,e.type=c),e.properties=d,e.extend=b.extend,e},b.properties={},b.models={},b.create=function(a){var c=b.models[a.type];return c||console.error("no such model"+a.type),new c(a)},a.eventize(b);var c=b.prototype;a.eventize(c),c.observeProperty=function(a){var b=this;this[a].change(function(c,d){b.emit("change",a,c,d,this)})},c.toString=function(){return"#<"+this.type+":"+this.id+">"},c.initialize=function(a){},c.update=function(a){for(var b in a)b in this.constructor.properties&&this[b](a[b])},c.delete=function(){this.emit("delete",this)},c.toJSON=function(){var a=this.constructor.properties,b={};for(var c in a){var d=this[c]();d!==a[c]&&(b[c]=d)}return this.type&&(b.type=this.type),"id"in this&&(b.id=this.id),b},a.inherits=function(a,b){function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},a.model=b}();var l=k.prototype;l.genId=function(){return++this.id},l.add=function(a){a.id=a.id||this.genId(),this.objects[a.id]=a,a.collection=this,a.on&&a.on("*",this._onevent,this),a.emit&&a.emit("add",a),this.count.incr()},l._onevent=function(a,b,c){if((a=="add"||a=="remove")&&c!=this)return;a=="destroy"&&this.remove(model),this.emit.apply(this,arguments)},l.filter=function(a){var b=[];return this.forEach(function(c){a(c)&&b.push(c)}),b},l.find=function(a){return this.objects[a]},l.forEach=function(a){this.count();for(var b in this.objects)a.call(this,this.find(b))},l.remove=function(a){delete this.objects[a.id],this.count.incr(-1),this.emit("remove",a),this==a.collection&&delete a.collection,a.off&&a.off("all",this._onevent,this)},l.renderOne=function(b,c){var d=c.data("o_O:template"),e=$(d).appendTo(c);a.bind(b,e)},l.bind=function(a){var b=this;this.on("add",function(c){b.renderOne(c,a)}),this.on("remove",function(a){$(a.el).remove()})},a.collection=k}();