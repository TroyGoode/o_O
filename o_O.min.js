!function(){function a(){}function b(a,b){if(a.forEach)return a.forEach(b);for(var c=0,d=a.length;c<d;c++)c in a&&b.call(null,a[c],c,a)}function c(a){return a.replace(/^\s+|\s+$/g,"")}function f(b,c){function f(b){return arguments.length?(f.value=b,c?f.emit("set",f.value):d(f)):e&&a.__deps_hook.emit("get",f),f.value}return f.value=b,f.dependencies=[],f.incr=function(a){f(f.value+(a||1))},f}function g(b,c){function f(g){return arguments.length?(f.value=b(g),c?f.emit("set",f.value):d(f)):(f.value=b(),e&&a.__deps_hook.emit("get",f)),f.value}return f.dependencies=a.dependencies(f),f}function h(a,b,c){if(a.indexOf)return a.indexOf(b,c);for(var d=c||0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1}function i(a,b){var c=[];for(var d=0;d<a.length;d++)c.push(b(a[d],d));return c}function j(a){var b=c(a).split(";"),d=[];for(var e=0;e<b.length;e++){var f=b[e];f=c(f);if(!f)continue;var g=i(c(f).split(":"),c),h=c(g.shift()),j=c(g.join(":"));d.push([h,j])}return d}function l(b,c,d){c==null&&(c=b,b=undefined),c=c||{};var e=function f(e){if(!(this instanceof f))return new f(e);e=e||{};for(var g in c){var h=g in e?e[g]:c[g];this[g]=a.property(h,d),this.observeProperty(g)}this.type=b,this.id=e.id||a.uniqueId(),this.initialize.call(this,e),f.emit("create",this)};return a.eventize(e),a.inherits(e,this),b&&(l.classes[b]=e,e.type=b),e.properties=c,e.extend=this.extend,e}typeof module!="undefined"?module.exports=a:window.o_O=a,!function(){var b={on:function(a,b){return this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b),this},off:function(a,b){this._events=this._events||{};if(a in this._events==0)return;return this._events[a].splice(this._events[a].indexOf(b),1),this},emit:function(a){this._events=this._events||{};var b=Array.prototype.slice.call(arguments,1),c;if(c=this._events[a])for(var d=0;d<c.length;d++)c[d].apply(this,b);b.unshift(a);if(c=this._events["*"])for(var d=0;d<c.length;d++)c[d].apply(this,b);return this}};a.eventize=function(a){return a.on=b.on,a.off=b.off,a.emit=b.emit,a}}(),a.property=function(b){var c=typeof b=="function",d=c?g(b):f(b);return a.eventize(d),d.change=function(a){a?d.on("set",a):d(d())},d.toString=function(){return"#<Property:"+d.value+">"},d.__o_O=!0,d},a.property.is=function(a){return a.__o_O==1};var d=function(){function c(){for(var c=0;c<a.length;c++){var d=a[c];d.emit("set",d.value),delete d._emitting}b=null,a=[]}var a=[],b=null;return function(d){if(d._emitting)return;a.push(d),d._emitting=!0,b=b||setTimeout(function(){c()},0)}}(),e=!1;a.__deps_hook=a.eventize({}),a.dependencies=function(b){function d(a){h(c,a)<0&&a!=b&&c.push(a)}var c=[];return e=!0,a.__deps_hook.on("get",d),a.dependencies.lastResult=b(),a.__deps_hook.off("get",d),e=!1,c},a.expression=function(b){return a.expression.last=b,new Function("o_O","with(this) { { return ("+b+")} } ")},a.bindFunction=function(c,d){var e=a.dependencies(c),f=a.dependencies.lastResult,g=typeof f=="function";d(f),g||b(e,function(a){a.on("set",function(a){d(c())})})},a.bindElementToRule=function(b,c,d,e){var f=a.expression(d),g=function(){return f.call(e,a.helpers)};a.bindFunction(g,function(d){var f=typeof d=="function"&&!a.property.is(d)?function(a){return d.call(e,a)}:d;return a.bindings[c].call(e,f,$(b))})},a.bind=function(b,c){function e(c,d,e){var f=$(c),g=j(f.attr("bind"));for(var h=0;h<g.length;h++){var i=g[h];a.bindElementToRule(f,i[0],i[1],b)}f.attr("bind",null)}var d=$(c);b.el=d[0],$(c).filter("[bind^=foreach]").each(function(a,b){e(this,a,b)}),$(c).find("[bind^=foreach]").each(function(a,b){e(this,a,b)}),$(c).filter("[bind]").each(function(a,b){e(this,a,b)}),$(c).find("[bind]").each(function(a,b){e(this,a,b)})},a.helpers={},a.helpers.value=function(a){return function(b){return a($(b.currentTarget).val(),b)}},a.bindings={};if(typeof $!="undefined")for(var k in $.fn)(function(b){a.bindings[b]=function(a,c){c[b](a)}})(k);a.bindings["class"]=function(a,b){b.attr("class",a)},a.bindings.value=function(a,b){var c=this;a.on("set",function(a){var c=b.attr("type")=="checkbox";c?b.val(a):b.attr("checked",a)}),b.change(function(b){var c=$(b.srcElement).attr("type")=="checkbox",d=c?$(b.srcElement).attr("checked"):$(b.srcElement).val();a(d,b)}),a.change()},a.bindings.visible=function(a,b){a?b.show():b.hide()},a.bindings["if"]=function(a,b){a||b.remove()},a.bindings.ifnot=function(a,b){a&&b.remove()},a.uniqueId=function(){var b=++a.uniqueId.id,c=a.uniqueId.prefix;return c?c+b:b},a.uniqueId.id=0,l.extend=l,l.properties={},l.classes={},l.genId=function(){return l.namespace+ ++l.id},l.create=function(a){var b=l.classes[a.type];return b||console.error("no such klass"+a.type),new b(a)},a.eventize(l);var m=l.prototype;a.eventize(m),m.observeProperty=function(a){var b=this;this[a].change(function(c,d){b.emit("change",a,c,d,this)})},m.toString=function(){return"#<"+this.type+":"+this.id+">"},m.initialize=function(a){},m.update=function(a){for(var b in a)this.constructor.properties[b]!=undefined&&this[b](a[b])},m.delete=function(){this.emit("delete",this)},m.toJSON=function(){var a=this.constructor.properties,b={};for(var c in a){var d=this[c]();d!==a[c]&&(b[c]=d)}return this.type&&(b.type=this.type),"id"in this&&(b.id=this.id),b},a.inherits=function(a,b){function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},a.klass=l,a.bindings.foreach=function(a,b){a.render(b)};var n=function(b){this.objects={},this.count=a.property(0),this.id=0,a.eventize(this);if(b)for(var c=0;c<b.length;c++)this.add(b[c])},o=n.prototype;o.genId=function(){return++this.id},o.add=function(a){a.id=a.id||this.genId(),this.objects[a.id]=a,a.parent=this,this.emit("add",a);var b=this;for(var c in a){var d=a[c];d.emit&&d.change&&!function(c,d){c.change(function(c,e){b.emit("change",a,d,c,e)})}(d,c)}this.count.incr()},o.filter=function(a){var b=[];return this.each(function(c){a(c)&&b.push(c)}),b},o.find=function(a){return this.objects[a]},o.each=function(a){this.count();for(var b in this.objects)a.call(this,this.find(b))},o.remove=function(a){typeof a=="function"?this.each(function(b){a(b)&&this.remove(b)}):(delete this.objects[a.id],this.count.incr(-1),delete a.parent,delete a.id,this.emit("remove",a))},o.render=function(b){function d(d){var e=$(c).appendTo(b);a.bind(d,e)}var c=b.html();b.html("");for(var e in this.objects)d(this.find(e));this.on("add",d),this.on("remove",function(a){$(a.el).remove()})},a.collection=function(a){var b=new n(a);return b}}();