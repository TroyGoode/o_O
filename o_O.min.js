!function(){function a(){}function b(a,b){if(a.forEach)return a.forEach(b);for(var c=0,d=a.length;c<d;c++)c in a&&b.call(null,a[c],c,a)}function c(a){return a.replace(/^\s+|\s+$/g,"")}function e(b){function c(b){return arguments.length?(c.value=b,c.emit("set",c.value)):d&&a.__deps_hook.emit("get",c),c.value}return c.value=b,c.dependencies=[],c.incr=function(a){c(c.value+(a||1))},c}function f(b){function c(e){return arguments.length?(c.value=b(e),c.emit("set",c.value)):(c.value=b(),d&&a.__deps_hook.emit("get",c)),c.value}return c.dependencies=a.dependencies(c),c}function g(a,b,c){if(a.indexOf)return a.indexOf(b,c);for(var d=c||0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1}function h(a){var b=c(a).split(";"),d=[];for(var e=0;e<b.length;e++){var f=b[e];f=c(f);if(!f)continue;var g=c(f).split(":").map(c),h=c(g.shift()),i=c(g.join(":"));d.push([h,i])}return d}function j(b,c){c==null&&(c=b,b=undefined),c=c||{};var d=function e(d){if(!(this instanceof e))return new e(d);d=d||{};for(var f in c){var g=f in d?d[f]:c[f];this[f]=a.property(g),this.observeProperty(f)}this.type=b,this.id=d.id||a.uniqueId(),this.initialize.call(this,d),e.emit("create",this)};return a.eventize(d),a.inherits(d,this),b&&(j.classes[b]=d,d.type=b),d.properties=c,d.extend=this.extend,d}typeof module!="undefined"?module.exports=a:window.o_O=a,!function(){var b={on:function(a,b){return this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b),this},off:function(a,b){this._events=this._events||{};if(a in this._events==0)return;return this._events[a].splice(this._events[a].indexOf(b),1),this},emit:function(a){this._events=this._events||{};var b=Array.prototype.slice.call(arguments,1),c;if(c=this._events[a])for(var d=0;d<c.length;d++)c[d].apply(this,b);b.unshift(a);if(c=this._events["*"])for(var d=0;d<c.length;d++)c[d].apply(this,b);return this}};a.eventize=function(a){return a.on=b.on,a.off=b.off,a.emit=b.emit,a}}(),a.property=function(b){var c=typeof b=="function",d=c?f(b):e(b);return a.eventize(d),d.change=function(a){a?d.on("set",a):d(d())},d.toString=function(){return"#<Property:"+d.value+">"},d.__o_O=!0,d},a.property.is=function(a){return a.__o_O==1};var d=!1;a.__deps_hook=a.eventize({}),a.dependencies=function(b){function e(a){g(c,a)<0&&a!=b&&c.push(a)}var c=[];return d=!0,a.__deps_hook.on("get",e),a.dependencies.lastResult=b(),a.__deps_hook.off("get",e),d=!1,c},a.expression=function(b){return a.expression.last=b,new Function("o_O","with(this) { { return ("+b+")} } ")},a.bindFunction=function(c,d){var e=a.dependencies(c),f=a.dependencies.lastResult,g=typeof f=="function";d(f),g||b(e,function(a){a.on("set",function(a){d(c())})})},a.bindElementToRule=function(b,c,d,e){var f=a.expression(d),g=function(){return f.call(e,a.helpers)};a.bindFunction(g,function(d){var f=typeof d=="function"&&!a.property.is(d)?function(a){return d.call(e,a)}:d;return a.bindings[c].call(e,f,$(b))})},a.bind=function(b,c){function e(c,d,e){var f=$(c),g=h(f.attr("bind"));for(var i=0;i<g.length;i++){var j=g[i];a.bindElementToRule(f,j[0],j[1],b)}f.attr("bind",null)}var d=$(c);b.el=d[0],$(c).filter("[bind^=foreach]").each(function(a,b){e(this,a,b)}),$(c).find("[bind^=foreach]").each(function(a,b){e(this,a,b)}),$(c).filter("[bind]").each(function(a,b){e(this,a,b)}),$(c).find("[bind]").each(function(a,b){e(this,a,b)})},a.helpers={},a.helpers.value=function(a){return function(b){return a($(b.currentTarget).val(),b)}},a.bindings={};if(typeof $!="undefined")for(var i in $.fn)(function(b){a.bindings[b]=function(a,c){c[b](a)}})(i);a.bindings["class"]=function(a,b){b.attr("class",a)},a.bindings.value=function(a,b){var c=this;a.on("set",function(a){var c=b.attr("type")=="checkbox";c?b.val(a):b.attr("checked",a)}),b.change(function(b){var c=$(b.srcElement).attr("type")=="checkbox",d=c?$(b.srcElement).attr("checked"):$(b.srcElement).val();a(d,b)}),a.change()},a.bindings.visible=function(a,b){a?b.show():b.hide()},a.bindings["if"]=function(a,b){a||b.remove()},a.bindings.ifnot=function(a,b){a&&b.remove()},a.uniqueId=function(){var b=++a.uniqueId.id,c=a.uniqueId.prefix;return c?c+b:b},a.uniqueId.id=0,j.extend=j,j.properties={},j.classes={},j.genId=function(){return j.namespace+ ++j.id},j.create=function(a){var b=j.classes[a.type];return b||console.error("no such klass"+a.type),new b(a)},a.eventize(j);var k=j.prototype;a.eventize(k),k.observeProperty=function(a){var b=this;this[a].change(function(c,d){b.emit("change",a,c,d,this)})},k.toString=function(){return"#<"+this.type+":"+this.id+">"},k.initialize=function(a){},k.update=function(a){for(var b in a)this.constructor.properties[b]!=undefined&&this[b](a[b])},k.delete=function(){this.emit("delete",this)},k.toJSON=function(){var a=this.constructor.properties,b={};for(var c in a){var d=this[c]();d!==a[c]&&(b[c]=d)}return this.type&&(b.type=this.type),"id"in this&&(b.id=this.id),b},a.inherits=function(a,b){function c(){this.constructor=a}return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},a.klass=j,a.bindings.foreach=function(a,b){a.render(b)};var l=function(b){this.objects={},this.count=a.property(0),this.id=0,a.eventize(this);if(b)for(var c=0;c<b.length;c++)this.add(b[c])},m=l.prototype;m.genId=function(){return++this.id},m.add=function(a){a.id=a.id||this.genId(),this.objects[a.id]=a,a.parent=this,this.emit("add",a);var b=this;for(var c in a){var d=a[c];d.emit&&d.change&&!function(c,d){c.change(function(c,e){b.emit("change",a,d,c,e)})}(d,c)}this.count.incr()},m.filter=function(a){var b=[];return this.each(function(c){a(c)&&b.push(c)}),b},m.find=function(a){return this.objects[a]},m.each=function(a){this.count();for(var b in this.objects)a.call(this,this.find(b))},m.remove=function(a){typeof a=="function"?this.each(function(b){a(b)&&this.remove(b)}):(delete this.objects[a.id],this.count.incr(-1),delete a.parent,delete a.id,this.emit("remove",a))},m.render=function(b){function d(d){var e=$(c).appendTo(b);a.bind(d,e)}var c=b.html();b.html("");for(var e in this.objects)d(this.find(e));this.on("add",d),this.on("remove",function(a){$(a.el).remove()})},a.collection=function(a){var b=new l(a);return b}}();